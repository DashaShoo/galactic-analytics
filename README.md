# Сервис межгалактической аналитики

Приложение для загрузки CSV таблиц, получения аналитики, генерации тестовых данных и хранения истории загрузок.  

## Технологический стек
- React + JavaScript  
- Zustand (state-менеджер)  
- CSS Modules (стили)  
- react-router-dom (роутинг)  
- Fetch API (работа с сервером)  
- React Portals (модальные окна)  
- Vite (сборка проекта)
- Vitest (unit-тесты)
- Testplane (E2E и интеграционное тестирование)


---

## Запуск проекта

### Требования
- Node.js v16+  
- npm или yarn  

### Установка зависимостей
```bash
npm install
```

### Запуск проекта
```bash
npm run dev
```

## Архитектура проекта
src/ – исходный код

components/ – переиспользуемые UI-компоненты (кнопки, лейблы, таблицы и т.д.)

pages/ – страницы приложения (Загрузка, Генератор, История)

hooks/ – кастомные React-хуки (например, useFileUpload, useReportGenerator)

services/ – сервисы для работы с API и локальным хранилищем

store/ – Zustand state-менеджер

api/ – функции для запросов к backend

public/ – статические файлы

## Основные компоненты
- Header - Компонент шапки, поддерживает навигацию по страницам

- Title - Компонент заголовка страницы

- Upload - 
Компонент загрузки CSV-файлов с поддержкой drag&drop и кнопки выбора файла.
Обрабатывает валидацию по расширению файла, отображает статус загрузки и ошибки, интегрируется с хуком useFileUpload для отправки данных на сервер.

- Generator -
Компонент генерации тестовых CSV-файлов. При нажатии отправляет запрос на сервер, получает и сохраняет сгенерированный файл, отображает статус процесса.

- History - Компонент отображения истории аналитики, полученной из localstoradge. Позволяет удалять все историю или отдельные ее элементы.

- AnalyticsRow -
Строчка полученной аналитики для формирования таблицы/модального окна.

- AnalyticsTable - 
Таблица для отображения полученной аналитики из загруженного файла.

- Modal - Компонент модального окна.

- StatusLabel - 
Отображение текущего статуса загрузки или генерации (idle, parsing, success, error).

- ClearButton / UploadButton / Button - 
Переиспользуемые кнопки с поддержкой разных состояний и стилей.

## State management
Используется Zustand для хранения состояния загрузки файла.

## Взаимодействие с backend
uploadFile(file: File) — отправка файла на сервер с обработкой потокового ответа и постепенным обновлением аналитики

generateReport(params) — запрос генерации тестового отчёта

История загрузок хранится в localStorage

## Дополнительно
Модальные окна реализованы через React Portals

Навигация по страницам через react-router-dom

Код форматируется и проверяется ESLint и Prettier


## Примечания
Сервер должен работать на http://localhost:3000


## Тестировние

### Запуск тестирования
Установить зависимости
```bash
npm install
```

Запустить сам проект
```bash
npm run dev
```

Запустить unit-тестирование
```bash
npm run test
```

Запустить e2e-тестирование (Сервер должен работать на http://localhost:3000)
```bash
npm run test:e2e
```


### Описание интеграционных тестов
Ниже описаны ключевые сценарии, покрытые интеграционными тестами. Эти тесты проверяют взаимодействие между компонентами, API и localStorage, моделируя реальные пользовательские действия.

#### 1. Постепенная загрузка данных
Цель: Убедиться, что данные поступают с сервера частями, визуализируются по мере получения, а итог сохраняется в историю.

1. Загружается CSV-файл через input.
2. Кнопка "Отправить" инициирует запрос к API.
3. Тест отслеживает обновление значений на экране (имитируется постепенная загрузка).
4. После завершения отображения статуса "готово", происходит проверка:
   - что значение обновлялось более одного раза (данные приходили частями),
   - что запись с корректным именем файла и статусом success была добавлена в localStorage.


#### 2. Отображение истории из localStorage
Цель: Проверить, что при наличии истории в локальном хранилище, она корректно отображается на странице.

1. Вручную в localStorage добавляется фиктивная запись (integration.csv).
2. Переход на страницу /history.
3. Проверяется, что элемент с этим именем появляется в DOM и отображает корректные данные.

#### 3. Генерация файла отчёта
Цель: Проверить полный цикл генерации отчёта, смену статуса и сброс интерфейса.

1. Переход на страницу /generate.
2. Нажатие кнопки "Начать генерацию".
3. Ожидание смены статуса на "файл сгенерирован".
4. Проверка появления кнопки "Очистить".
5. Клик по кнопке "Очистить" сбрасывает состояние (статус и UI).
6. Проверяется, что снова отображается кнопка начала генерации, а статус очищен.


### Описание unit-тестов
Ниже описаны ключевые сценарии, покрытые unit-тестами.
#### Generator (генератор файлов для аналитики)
- Отображается кнопка "Начать генерацию".
- При ошибке генерации — появляется сообщение об ошибке.

#### History (история аналитики)
- Если история пуста — список и кнопка "Очистить всё" не показываются.
- Если есть история — показываются записи и кнопка "Очистить всё".
- Удаление одной записи — удаляется только она, остальные остаются.
- Очистка всей истории — вызывает clearHistory.
- Клик по успешной записи — открывает модалку.
- Клик по неуспешной — модалка не появляется.

#### Навигация
- По адресу / отображается страница аналитики.
- /generate — страница генерации.
- /history — страница истории.
- Кнопка "Сгенерировать больше" на странице истории ведёт на генерацию.
- Навигация по клику в шапке:
  - "CSV Аналитик" → /
  - "CSV Генератор" → /generate
  - "История" → /history

#### Upload (загрузка CSV)
- Отображается дроп-зона.
- Кнопка отправки недоступна при:
  - Ошибке
  - Отсутствии файла
- Неподдерживаемый формат файла отклоняется.
- Drag-n-drop (dragEnter / dragLeave)
- Кнопка очистки вызывает resetUploadState и возвращает плейсхолдер.
- Если файл неподдерживаемый — устанавливается статус "error".
- Если аналитики нет — отображается плейсхолдер.
- Если аналитика есть — отображаются все строки результата.

### Покрытие функциональных требований тестами:
#### Главная страница
- Загрузка таблицы через drag&drop или кнопку - ✓
- Реализация запроса с постепенным получением данных - ✓
- Данные накапливаются плавно - ✓
- Есть обработка ошибок - ✓
- Отображение индикатора загрузки - ✓
- По окончании работы запроса в localStorage складывается запись об истории - ✓
- Кнопка очистить - пропадают хайлайты и подгруженный файл (интерфейс сбрасывается до начального состояния) - ✓

#### Шапка
- Роутинг работает, страницы переключаются - ✓

#### Страница генерации
- При клике на кнопку отправляется запрос за генерацией и автоматически начинается загрузка файла - ✓
- Есть обработка ошибок - ✓

#### Страница истории
- При загрузке страницы данные из localStorage выгружаются и страница инициализируется со списком - ✓
- Удаление отдельных записей истории - ✓
- При клике на пункт списка открывается модальное окно с хайлайтами - ✓
- Полная очистка истории - ✓
- Кнопка "сгенерировать больше" редиректит на генерацию - ✓